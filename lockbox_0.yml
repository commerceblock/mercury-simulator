---
version: "3.8"
services:
  lockbox_0:
    image: lockbox:test_replica_3
    networks:
      - default
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
    ports:
      - "19000:8000"
    environment:
      SGX_MODE: SW
      SGX_SDK: /opt/intel/sgxsdk
      LD_LIBRARY_PATH: /opt/intel/sgxsdk/sdk_libs
      LOCKBOX_DB_PATH: /tmp/lockbox
      LOCKBOX_KEY_DB_PATH: /tmp/lockbox_key
      LOCKBOX_ENC_INDEX: 0
      LOCKBOX_URL_SRC: http://lockbox_0:8000
      LOCKBOX_URL_DST: http://lockbox_1:8000
    volumes:
      - ./data/lockbox_0:/tmp/lockbox
      - ./data/lockbox_key_0:/tmp/lockbox_key
    command: >
      bash -c "LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/intel/sgx-aesm-service/aesm/ /opt/intel/sgx-aesm-service/aesm/aesm_service;
                /opt/lockbox/bin/server_exec"
